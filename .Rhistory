q()
library(maftools)
maf_path <- "/Users/rshibaki/Documents/project/ADJUST/adjust/maf_test.tsv"
maf_data <- read.maf(maf = maf_path, vc_nonSyn = FALSE, data.table = FALSE)
oncoplot(maf = maf_data, showTumorSampleBarcodes = TRUE)
library(maftools)
maf_path <- "/Users/rshibaki/Documents/project/ADJUST/adjust/maf_test.tsv"
maf_data <- read.maf(maf = maf_path, vc_nonSyn = FALSE, removeSilent = FALSE)
oncoplot(maf = maf_data, showTumorSampleBarcodes = TRUE)
library(maftools)
maf_path <- "/Users/rshibaki/Documents/project/ADJUST/adjust/maf_test.tsv"
maf_data <- read.maf(maf = maf_path, vc_nonSyn = FALSE, verbose = TRUE)
library(maftools)
getVariantClassification()
library(maftools)
maf_path <- "/Users/rshibaki/Documents/project/ADJUST/adjust/maf_test.tsv"
# ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ï¼ˆã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚ã€éƒ¨åˆ†çš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹å¯èƒ½æ€§ã‚ã‚Šï¼‰
maf_data <- tryCatch(
    read.maf(maf = maf_path, vc_nonSyn = NULL, verbose = TRUE),
    error = function(e) return(NULL)
)
# èªè­˜ã•ã‚ŒãŸ Variant_Classification ã‚’ç¢ºèª
if (!is.null(maf_data)) {
    print(maf_data@data$Variant_Classification)
} else {
    print("MAF ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")
}
library(maftools)
oncoplot(maf = maf_data, showTumorSampleBarcodes = TRUE)
q()
library(maftools)
plot_oncoplot <- function(maf_file, sample_order) {
    maf_data <- read.maf(maf = maf_file)
    # `WRN` ã¨ `DICER1` ã®å¤‰ç•°é »åº¦ã‚’å–å¾—
    gene_summary <- getGeneSummary(maf_data)
    print("WRN ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "WRN", c("Hugo_Symbol", "MutatedSamples")])
    
    print("DICER1 ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "DICER1", c("Hugo_Symbol", "MutatedSamples")])
    output_path <- file.path(getwd(), "oncoplot.png")
    
    png(output_path, width = 1500, height = 1000)
    oncoplot(maf = maf_data, 
             showTumorSampleBarcodes = TRUE, 
             sampleOrder = sample_order, 
             showGenes = c("WRN", "DICER1"),  
             minMut = 1,  # å¤‰ç•°ãŒ1ã¤ã§ã‚‚ã‚ã‚‹éºä¼å­ã‚’å«ã‚ã‚‹
             top = 30)  
    dev.off()
    
    print(paste("Oncoplot ã‚’ä¿å­˜ã—ã¾ã—ãŸ:", output_path))
    return(invisible(NULL))
}
library(maftools)
plot_oncoplot <- function(maf_file, sample_order) {
    maf_data <- read.maf(maf = maf_file)
    # `WRN` ã¨ `DICER1` ã®å¤‰ç•°é »åº¦ã‚’å–å¾—
    gene_summary <- getGeneSummary(maf_data)
    print("WRN ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "WRN", c("Hugo_Symbol", "MutatedSamples")])
    
    print("DICER1 ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "DICER1", c("Hugo_Symbol", "MutatedSamples")])
    output_path <- file.path(getwd(), "oncoplot.png")
    
    png(output_path, width = 1500, height = 1000)
    oncoplot(maf = maf_data, 
             showTumorSampleBarcodes = TRUE, 
             sampleOrder = sample_order, 
             showGenes = c("WRN", "DICER1"),  
             minMut = 1,  # å¤‰ç•°ãŒ1ã¤ã§ã‚‚ã‚ã‚‹éºä¼å­ã‚’å«ã‚ã‚‹
             top = 30)  
    dev.off()
    
    print(paste("Oncoplot ã‚’ä¿å­˜ã—ã¾ã—ãŸ:", output_path))
    return(invisible(NULL))
}
library(maftools)
plot_oncoplot <- function(maf_file, sample_order) {
    maf_data <- read.maf(maf = maf_file)
    # `WRN` ã¨ `DICER1` ã®å¤‰ç•°é »åº¦ã‚’å–å¾—
    gene_summary <- getGeneSummary(maf_data)
    print("WRN ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "WRN", c("Hugo_Symbol", "MutatedSamples")])
    
    print("DICER1 ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "DICER1", c("Hugo_Symbol", "MutatedSamples")])
    output_path <- file.path(getwd(), "oncoplot.png")
    
    png(output_path, width = 1500, height = 1000)
    oncoplot(maf = maf_data, 
             showTumorSampleBarcodes = TRUE, 
             sampleOrder = sample_order, 
             showGenes = c("WRN", "DICER1"),  
             minMut = 1,  # å¤‰ç•°ãŒ1ã¤ã§ã‚‚ã‚ã‚‹éºä¼å­ã‚’å«ã‚ã‚‹
             top = 30)  
    dev.off()
    
    print(paste("Oncoplot ã‚’ä¿å­˜ã—ã¾ã—ãŸ:", output_path))
    return(invisible(NULL))
}
[200~library(maftools)
plot_oncoplot <- function(maf_file, sample_order) {
    maf_data <- read.maf(maf = maf_file)
    # `WRN` ã¨ `DICER1` ã®å¤‰ç•°é »åº¦ã‚’å–å¾—
    gene_summary <- getGeneSummary(maf_data)
    print("WRN ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "WRN", c("Hugo_Symbol", "MutatedSamples")])
    
    print("DICER1 ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "DICER1", c("Hugo_Symbol", "MutatedSamples")])
    output_path <- file.path(getwd(), "oncoplot.png")
    
    png(output_path, width = 1500, height = 1000)
    oncoplot(maf = maf_data, 
             showTumorSampleBarcodes = TRUE, 
             sampleOrder = sample_order, 
             showGenes = c("WRN", "DICER1"),  
             minMut = 1,  # å¤‰ç•°ãŒ1ã¤ã§ã‚‚ã‚ã‚‹éºä¼å­ã‚’å«ã‚ã‚‹
             top = 30)  
    dev.off()
    
    print(paste("Oncoplot ã‚’ä¿å­˜ã—ã¾ã—ãŸ:", output_path))
    return(invisible(NULL))
}
q()
library(maftools)
plot_oncoplot <- function(maf_file, sample_order) {
    maf_data <- read.maf(maf = maf_file)
    # `WRN` ã¨ `DICER1` ã®å¤‰ç•°é »åº¦ã‚’å–å¾—
    gene_summary <- getGeneSummary(maf_data)
    print("WRN ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "WRN", c("Hugo_Symbol", "MutatedSamples")])
    
    print("DICER1 ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "DICER1", c("Hugo_Symbol", "MutatedSamples")])
    output_path <- file.path(getwd(), "oncoplot.png")
    
    png(output_path, width = 1500, height = 1000)
    oncoplot(maf = maf_data, 
             showTumorSampleBarcodes = TRUE, 
             sampleOrder = sample_order, 
             showGenes = c("WRN", "DICER1"),  
             minMut = 1,  # å¤‰ç•°ãŒ1ã¤ã§ã‚‚ã‚ã‚‹éºä¼å­ã‚’å«ã‚ã‚‹
             top = 30)  
    dev.off()
    
    print(paste("Oncoplot ã‚’ä¿å­˜ã—ã¾ã—ãŸ:", output_path))
    return(invisible(NULL))
}
library(maftools)
plot_oncoplot <- function(maf_file, sample_order) {
    maf_data <- read.maf(maf = maf_file)
    # `WRN` ã¨ `DICER1` ã®å¤‰ç•°é »åº¦ã‚’å–å¾—
    gene_summary <- getGeneSummary(maf_data)
    print("WRN ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "WRN", c("Hugo_Symbol", "MutatedSamples")])
    print("DICER1 ã®å¤‰ç•°é »åº¦:")
    print(gene_summary[gene_summary$Hugo_Symbol == "DICER1", c("Hugo_Symbol", "MutatedSamples")])
    output_path <- file.path(getwd(), "oncoplot.png")
    png(output_path, width = 1500, height = 1000)
    oncoplot(maf = maf_data, 
             showTumorSampleBarcodes = TRUE, 
             sampleOrder = sample_order, 
             showGenes = c("WRN", "DICER1"),  
             minMut = 1,  # å¤‰ç•°ãŒ1ã¤ã§ã‚‚ã‚ã‚‹éºä¼å­ã‚’å«ã‚ã‚‹
             top = 30)  
    dev.off()
    print(paste("Oncoplot ã‚’ä¿å­˜ã—ã¾ã—ãŸ:", output_path))
    return(invisible(NULL))
}
q()
# Excel ã®ã€Œmain_Selectedã€ã‚·ãƒ¼ãƒˆã‹ã‚‰å¤‰ç•°ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™
mutation_df <- read_excel("ADJUST_DNA.xlsx", sheet = "main_Selected")
print(paste("å¤‰ç•°ãƒ‡ãƒ¼ã‚¿ã®ä»¶æ•°ï¼š", nrow(mutation_df)))
# ä½¿ç”¨ã™ã‚‹åˆ—ã ã‘ã‚’æ®‹ã™ï¼ˆå¿…è¦ãªåˆ—ã«åˆã‚ã›ã¦ãã ã•ã„ï¼‰
columns_needed <- c("Patient_ID", "Chromosome", "Region", "Type", "Reference", "Allele",
                    "Gene Cards", "Non-synonymous", "Coding region change")
mutation_df <- mutation_df[, columns_needed]
# Chromosome ã¨ Region ã¯æ–‡å­—åˆ—å‹ã«å¤‰æ›
mutation_df$Chromosome <- as.character(mutation_df$Chromosome)
mutation_df$Region <- as.character(mutation_df$Region)
ã‚¨ãƒ©ãƒ¼: `path` does not exist: â€˜ADJUST_DNA.xlsxâ€™
> 
# Excel ã®ã€Œmain_Selectedã€ã‚·ãƒ¼ãƒˆã‹ã‚‰å¤‰ç•°ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™
mutation_df <- read_excel("/Users/rshibaki/Library/CloudStorage/GoogleDrive-ryota.shibaki@gmail.com/ãƒã‚¤ãƒˆã‚™ãƒ©ã‚¤ãƒ•ã‚™/ADJUSTè©¦é¨“/DATA/ADJUST_DNA.xlsx", sheet = "main_Selected")
print(paste("å¤‰ç•°ãƒ‡ãƒ¼ã‚¿ã®ä»¶æ•°ï¼š", nrow(mutation_df)))
# ä½¿ç”¨ã™ã‚‹åˆ—ã ã‘ã‚’æ®‹ã™ï¼ˆå¿…è¦ãªåˆ—ã«åˆã‚ã›ã¦ãã ã•ã„ï¼‰
columns_needed <- c("Patient_ID", "Chromosome", "Region", "Type", "Reference", "Allele",
                    "Gene Cards", "Non-synonymous", "Coding region change")
mutation_df <- mutation_df[, columns_needed]
# Chromosome ã¨ Region ã¯æ–‡å­—åˆ—å‹ã«å¤‰æ›
mutation_df$Chromosome <- as.character(mutation_df$Chromosome)
mutation_df$Region <- as.character(mutation_df$Region)
install.packages("readxl")
library(readxl)
# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿
library(readxl)
# Excel ã®ã€Œmain_Selectedã€ã‚·ãƒ¼ãƒˆã‹ã‚‰å¤‰ç•°ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™
mutation_df <- read_excel("/Users/rshibaki/Library/CloudStorage/GoogleDrive-ryota.shibaki@gmail.com/ãƒã‚¤ãƒˆã‚™ãƒ©ã‚¤ãƒ•ã‚™/ADJUSTè©¦é¨“/DATA/ADJUST_DNA.xlsx", sheet = "main_Selected")
print(paste("å¤‰ç•°ãƒ‡ãƒ¼ã‚¿ã®ä»¶æ•°ï¼š", nrow(mutation_df)))
# ä½¿ç”¨ã™ã‚‹åˆ—ã ã‘ã‚’æ®‹ã™ï¼ˆå¿…è¦ãªåˆ—ã«åˆã‚ã›ã¦ãã ã•ã„ï¼‰
columns_needed <- c("Patient_ID", "Chromosome", "Region", "Type", "Reference", "Allele",
                    "Gene Cards", "Non-synonymous", "Coding region change")
mutation_df <- mutation_df[, columns_needed]
# Chromosome ã¨ Region ã¯æ–‡å­—åˆ—å‹ã«å¤‰æ›
mutation_df$Chromosome <- as.character(mutation_df$Chromosome)
mutation_df$Region <- as.character(mutation_df$Region)
# æ–‡å­—åˆ—ã‹ã‚‰æ•°å­—ã ã‘ã‚’å–ã‚Šå‡ºã—ã¦é–‹å§‹ãƒ»çµ‚äº†ä½ç½®ã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°
extract_positions <- function(region) {
  if (grepl("\\.\\.", region)) {
    parts <- unlist(strsplit(region, "\\.\\.")) 
    start <- as.numeric(gsub("[^0-9]", "", parts[1]))
    end   <- as.numeric(gsub("[^0-9]", "", parts[2]))
  } else {
    start <- end <- as.numeric(gsub("[^0-9]", "", region))
  }
  return(c(start, end))
}
# apply() ã§å„è¡Œã«å¯¾ã—ã¦é–¢æ•°ã‚’å®Ÿè¡Œã—ã€æ–°ãŸã« Start_Position ã¨ End_Position åˆ—ã‚’è¿½åŠ 
positions <- t(sapply(mutation_df$Region, extract_positions))
mutation_df$Start_Position <- positions[, 1]
mutation_df$End_Position   <- positions[, 2]
# å¤‰ç•°ã‚¿ã‚¤ãƒ—ã‚’æ±ºã‚ã‚‹é–¢æ•°
determine_variant_type <- function(ref, alt) {
  if (nchar(ref) == 1 && nchar(alt) == 1) {
    return("SNP")
  } else if (nchar(ref) > nchar(alt)) {
    return("DEL")
  } else if (nchar(ref) < nchar(alt)) {
    return("INS")
  } else {
    return("OTHER")
  }
}
mutation_df$Variant_Type <- mapply(determine_variant_type, mutation_df$Reference, mutation_df$Allele)
# å¤‰ç•°åˆ†é¡ï¼ˆã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ã€Non-synonymous ãŒ "Yes" ãªã‚‰ Missense_Mutationã€ãã‚Œä»¥å¤–ã¯ Frame_Shift_Del ã¨ã™ã‚‹ï¼‰
classify_variant <- function(row) {
  # row ã¯ãƒªã‚¹ãƒˆï¼ˆã¾ãŸã¯ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã® 1 è¡Œï¼‰
  if (toupper(row["Non-synonymous"]) == "YES") {
    if (row["Type"] == "SNV") {
      return("Missense_Mutation")
    } else {
      return("Frame_Shift_Del")
    }
  } else {
    return("Missense_Mutation")
  }
}
mutation_df$Variant_Classification <- apply(mutation_df, 1, classify_variant)
# åˆ—åã®å¤‰æ›´ï¼šPatient_ID â†’ Tumor_Sample_Barcodeã€Gene Cards â†’ Hugo_Symbolã€Reference â†’ Reference_Alleleã€Allele â†’ Tumor_Seq_Allele2
maf_df <- mutation_df
names(maf_df)[names(maf_df) == "Patient_ID"] <- "Tumor_Sample_Barcode"
names(maf_df)[names(maf_df) == "Gene Cards"] <- "Hugo_Symbol"
names(maf_df)[names(maf_df) == "Reference"] <- "Reference_Allele"
names(maf_df)[names(maf_df) == "Allele"] <- "Tumor_Seq_Allele2"
# å¿…è¦ãªåˆ—ã ã‘ã‚’æ®‹ã™
maf_df <- maf_df[, c("Tumor_Sample_Barcode", "Hugo_Symbol", "Chromosome",
                     "Start_Position", "End_Position", "Reference_Allele",
                     "Tumor_Seq_Allele2", "Variant_Classification", "Variant_Type")]
# TSV ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ï¼ˆå¿…è¦ã«å¿œã˜ã¦ãƒ‘ã‚¹ã‚’å¤‰æ›´ï¼‰
write.table(maf_df, file = "maf_test.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
print("maf_test.tsv ã‚’ä½œæˆã—ã¾ã—ãŸã€‚")
# MAF ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
maf_object <- read.maf(maf = "maf_test.tsv")
# ã‚ªãƒ³ã‚³ãƒ—ãƒ­ãƒƒãƒˆã‚’ png ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã™ã‚‹ï¼ˆã“ã“ã§ã¯ TMB æ£’ã‚°ãƒ©ãƒ•ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤ºã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å¾Œã§ã‚«ã‚¹ã‚¿ãƒ ã‚°ãƒ©ãƒ•ã¨ç½®ãæ›ãˆã¾ã™ï¼‰
png(filename = "oncoplot.png", width = 1200, height = 800)
oncoplot(maf = maf_object, showTumorSampleBarcodes = TRUE)
dev.off()
print("oncoplot.png ã‚’ä½œæˆã—ã¾ã—ãŸã€‚")
# readxl ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæœ€åˆã®ã¿ï¼‰
install.packages("readxl")
install.packages("ggplot2")
install.packages("maftools")
install.packages("png")
install.packages("gridExtra")
library(readxl)     # Excel ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ç”¨
library(ggplot2)    # ã‚°ãƒ©ãƒ•ä½œæˆç”¨
library(maftools)   # ã‚ªãƒ³ã‚³ãƒ—ãƒ­ãƒƒãƒˆä½œæˆç”¨
library(png)        # PNG ç”»åƒèª­ã¿è¾¼ã¿ç”¨
library(gridExtra)  # è¤‡æ•°ã‚°ãƒ©ãƒ•ã‚’ã¾ã¨ã‚ã‚‹ç”¨
# Excel ã®ã€Œmain_Selectedã€ã‚·ãƒ¼ãƒˆã‹ã‚‰å¤‰ç•°ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™
mutation_df <- read_excel("ADJUST_DNA.xlsx", sheet = "main_Selected")
print(paste("å¤‰ç•°ãƒ‡ãƒ¼ã‚¿ã®ä»¶æ•°ï¼š", nrow(mutation_df)))
# ä½¿ç”¨ã™ã‚‹åˆ—ã ã‘ã‚’æ®‹ã™ï¼ˆå¿…è¦ãªåˆ—ã«åˆã‚ã›ã¦ãã ã•ã„ï¼‰
columns_needed <- c("Patient_ID", "Chromosome", "Region", "Type", "Reference", "Allele",
                    "Gene Cards", "Non-synonymous", "Coding region change")
mutation_df <- mutation_df[, columns_needed]
# Chromosome ã¨ Region ã¯æ–‡å­—åˆ—å‹ã«å¤‰æ›
mutation_df$Chromosome <- as.character(mutation_df$Chromosome)
mutation_df$Region <- as.character(mutation_df$Region)
# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿
library(readxl)
# Excel ã®ã€Œmain_Selectedã€ã‚·ãƒ¼ãƒˆã‹ã‚‰å¤‰ç•°ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™
mutation_df <- read_excel("/Users/rshibaki/Library/CloudStorage/GoogleDrive-ryota.shibaki@gmail.com/ãƒã‚¤ãƒˆã‚™ãƒ©ã‚¤ãƒ•ã‚™/ADJUSTè©¦é¨“/DATA/ADJUST_DNA.xlsx", sheet = "main_Selected")
print(paste("å¤‰ç•°ãƒ‡ãƒ¼ã‚¿ã®ä»¶æ•°ï¼š", nrow(mutation_df)))
# ä½¿ç”¨ã™ã‚‹åˆ—ã ã‘ã‚’æ®‹ã™ï¼ˆå¿…è¦ãªåˆ—ã«åˆã‚ã›ã¦ãã ã•ã„ï¼‰
columns_needed <- c("Patient_ID", "Chromosome", "Region", "Type", "Reference", "Allele",
                    "Gene Cards", "Non-synonymous", "Coding region change")
mutation_df <- mutation_df[, columns_needed]
# Chromosome ã¨ Region ã¯æ–‡å­—åˆ—å‹ã«å¤‰æ›
mutation_df$Chromosome <- as.character(mutation_df$Chromosome)
mutation_df$Region <- as.character(mutation_df$Region)
# æ–‡å­—åˆ—ã‹ã‚‰æ•°å­—ã ã‘ã‚’å–ã‚Šå‡ºã—ã¦é–‹å§‹ãƒ»çµ‚äº†ä½ç½®ã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°
extract_positions <- function(region) {
  if (grepl("\\.\\.", region)) {
    parts <- unlist(strsplit(region, "\\.\\.")) 
    start <- as.numeric(gsub("[^0-9]", "", parts[1]))
    end   <- as.numeric(gsub("[^0-9]", "", parts[2]))
  } else {
    start <- end <- as.numeric(gsub("[^0-9]", "", region))
  }
  return(c(start, end))
}
# apply() ã§å„è¡Œã«å¯¾ã—ã¦é–¢æ•°ã‚’å®Ÿè¡Œã—ã€æ–°ãŸã« Start_Position ã¨ End_Position åˆ—ã‚’è¿½åŠ 
positions <- t(sapply(mutation_df$Region, extract_positions))
mutation_df$Start_Position <- positions[, 1]
mutation_df$End_Position   <- positions[, 2]
# å¤‰ç•°ã‚¿ã‚¤ãƒ—ã‚’æ±ºã‚ã‚‹é–¢æ•°
determine_variant_type <- function(ref, alt) {
  if (nchar(ref) == 1 && nchar(alt) == 1) {
    return("SNP")
  } else if (nchar(ref) > nchar(alt)) {
    return("DEL")
  } else if (nchar(ref) < nchar(alt)) {
    return("INS")
  } else {
    return("OTHER")
  }
}
mutation_df$Variant_Type <- mapply(determine_variant_type, mutation_df$Reference, mutation_df$Allele)
# å¤‰ç•°åˆ†é¡ï¼ˆã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ã€Non-synonymous ãŒ "Yes" ãªã‚‰ Missense_Mutationã€ãã‚Œä»¥å¤–ã¯ Frame_Shift_Del ã¨ã™ã‚‹ï¼‰
classify_variant <- function(row) {
  # row ã¯ãƒªã‚¹ãƒˆï¼ˆã¾ãŸã¯ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã® 1 è¡Œï¼‰
  if (toupper(row["Non-synonymous"]) == "YES") {
    if (row["Type"] == "SNV") {
      return("Missense_Mutation")
    } else {
      return("Frame_Shift_Del")
    }
  } else {
    return("Missense_Mutation")
  }
}
mutation_df$Variant_Classification <- apply(mutation_df, 1, classify_variant)
# åˆ—åã®å¤‰æ›´ï¼šPatient_ID â†’ Tumor_Sample_Barcodeã€Gene Cards â†’ Hugo_Symbolã€Reference â†’ Reference_Alleleã€Allele â†’ Tumor_Seq_Allele2
maf_df <- mutation_df
names(maf_df)[names(maf_df) == "Patient_ID"] <- "Tumor_Sample_Barcode"
names(maf_df)[names(maf_df) == "Gene Cards"] <- "Hugo_Symbol"
names(maf_df)[names(maf_df) == "Reference"] <- "Reference_Allele"
names(maf_df)[names(maf_df) == "Allele"] <- "Tumor_Seq_Allele2"
# å¿…è¦ãªåˆ—ã ã‘ã‚’æ®‹ã™
maf_df <- maf_df[, c("Tumor_Sample_Barcode", "Hugo_Symbol", "Chromosome",
                     "Start_Position", "End_Position", "Reference_Allele",
                     "Tumor_Seq_Allele2", "Variant_Classification", "Variant_Type")]
# TSV ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ï¼ˆå¿…è¦ã«å¿œã˜ã¦ãƒ‘ã‚¹ã‚’å¤‰æ›´ï¼‰
write.table(maf_df, file = "maf_test.tsv", sep = "\t", row.names = FALSE, quote = FALSE)
print("maf_test.tsv ã‚’ä½œæˆã—ã¾ã—ãŸã€‚")
# MAF ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
maf_object <- read.maf(maf = "maf_test.tsv")
# ã‚ªãƒ³ã‚³ãƒ—ãƒ­ãƒƒãƒˆã‚’ png ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã™ã‚‹ï¼ˆã“ã“ã§ã¯ TMB æ£’ã‚°ãƒ©ãƒ•ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤ºã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å¾Œã§ã‚«ã‚¹ã‚¿ãƒ ã‚°ãƒ©ãƒ•ã¨ç½®ãæ›ãˆã¾ã™ï¼‰
png(filename = "oncoplot.png", width = 1200, height = 800)
oncoplot(maf = maf_object, showTumorSampleBarcodes = TRUE)
dev.off()
print("oncoplot.png ã‚’ä½œæˆã—ã¾ã—ãŸã€‚")
# Excel ã®ã€ŒTMBã€ã‚·ãƒ¼ãƒˆã‹ã‚‰ TMB ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™
clinical_data <- read_excel("ADJUST_DNA.xlsx", sheet = "TMB")
# Patient_ID ã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã—ã€åˆ—åã‚’çµ±ä¸€
clinical_data$Patient_ID <- as.character(clinical_data$Patient_ID)
names(clinical_data)[names(clinical_data) == "Patient_ID"] <- "Tumor_Sample_Barcode"
names(clinical_data)[names(clinical_data) == "TMB (Mutations/Mb)"] <- "TMB"
# clinical_data ã«ã¯ DFS ãªã©ä»–ã®åˆ—ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã“ã§ã¯ TMB ã®å€¤ã ã‘ã‚’ä½¿ã„ã¾ã™
# Excel ã®ã€ŒTMBã€ã‚·ãƒ¼ãƒˆã‹ã‚‰ TMB ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™
clinical_data <- read_excel("/Users/rshibaki/Library/CloudStorage/GoogleDrive-ryota.shibaki@gmail.com/ãƒã‚¤ãƒˆã‚™ãƒ©ã‚¤ãƒ•ã‚™/ADJUSTè©¦é¨“/DATA/ADJUST_DNA.xlsx", sheet = "TMB")
# Patient_ID ã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã—ã€åˆ—åã‚’çµ±ä¸€
clinical_data$Patient_ID <- as.character(clinical_data$Patient_ID)
names(clinical_data)[names(clinical_data) == "Patient_ID"] <- "Tumor_Sample_Barcode"
names(clinical_data)[names(clinical_data) == "TMB (Mutations/Mb)"] <- "TMB"
# clinical_data ã«ã¯ DFS ãªã©ä»–ã®åˆ—ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã“ã§ã¯ TMB ã®å€¤ã ã‘ã‚’ä½¿ã„ã¾ã™
tmb_plot <- ggplot(clinical_data, aes(x = Tumor_Sample_Barcode, y = TMB)) +
  geom_bar(stat = "identity", fill = "steelblue") +    # æ£’ã‚°ãƒ©ãƒ•ã‚’æã
  theme_minimal() +                                     # ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ãƒ¼ãƒ
  xlab("") +                                            # æ¨ªè»¸ãƒ©ãƒ™ãƒ«ã‚’ç©ºã«ã™ã‚‹
  ylab("TMB (Mutations/Mb)") +                          # ç¸¦è»¸ãƒ©ãƒ™ãƒ«ã‚’è¨­å®š
  theme(axis.text.x = element_text(angle = 90, hjust = 1))# æ¨ªè»¸ã®æ–‡å­—ã‚’90åº¦å›è»¢
print(tmb_plot)
# PNG ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç”»åƒã‚’èª­ã¿è¾¼ã¿ã€ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹
oncograph <- readPNG("oncoplot.png")
oncograph_grob <- rasterGrob(oncograph, interpolate = TRUE)
# PNG ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç”»åƒã‚’èª­ã¿è¾¼ã¿ã€ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹
oncograph <- readPNG("oncoplot.png")
oncograph_grob <- rasterGrob(oncograph, interpolate = TRUE)
library(grid)   # grid ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚€
library(png)    # PNG ã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
# PNG ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç”»åƒã‚’èª­ã¿è¾¼ã¿ã€ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹
oncograph <- readPNG("oncoplot.png")
oncograph_grob <- rasterGrob(oncograph, interpolate = TRUE)
# PNG ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç”»åƒã‚’èª­ã¿è¾¼ã¿ã€ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹
oncograph <- readPNG("oncoplot.png")
oncograph_grob <- rasterGrob(oncograph, interpolate = TRUE)
grid.arrange(oncograph_grob, tmb_plot, ncol = 1, heights = c(3, 1))
oncoplot(maf = maf_object,
         showTumorSampleBarcodes = TRUE,
         sampleOrder = sample_order,
         draw_tmb = FALSE)  # TMBã‚°ãƒ©ãƒ•ã‚’éè¡¨ç¤ºã«ã™ã‚‹
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("maftools")
oncoplot(maf = maf_object,
         showTumorSampleBarcodes = TRUE,
         sampleOrder = sample_order,
         draw_tmb = FALSE)
packageVersion("maftools")
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("maftools", force = TRUE)
oncoplot(maf = maf_object,
         showTumorSampleBarcodes = TRUE,
         sampleOrder = sample_order,
         draw_tmb = FALSE)
library(maftools)
plot_oncoplot <- function(maf_data, sample_order) {
    # MAF ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰ MAF ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
    maf_object <- read.maf(maf = as.data.frame(maf_data), vc_nonSyn = NULL)
    
    # ãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ï¼štumorSampleSummary ã® tmb å€¤ã‚’ã™ã¹ã¦ 0 ã«è¨­å®š
    maf_object@tumorSampleSummary$tmb <- rep(0, nrow(maf_object@tumorSampleSummary))
    
    output_path <- file.path(getwd(), "oncoplot.png")
    png(filename = output_path, width = 1200, height = 800)
    
    # TMB ã®å¼•æ•°ã¯æŒ‡å®šã›ãšã€sampleOrder ãªã©ã®å¿…è¦ãªå¼•æ•°ã®ã¿ã‚’æ¸¡ã™
    oncoplot(maf = maf_object, 
             showTumorSampleBarcodes = TRUE, 
             sampleOrder = sample_order)
    
    dev.off()
    
    print(paste("Oncoplot ã‚’ä¿å­˜ã—ã¾ã—ãŸ:", output_path))
}
maf_object@tumorSampleSummary$tmb <- rep(0, nrow(maf_object@tumorSampleSummary))
oncoplot(maf = maf_object,
         showTumorSampleBarcodes = TRUE,
         sampleOrder = sample_order,
         draw_tmb = FALSE)
library(maftools)
plot_oncoplot <- function(maf_data, sample_order) {
    # ãƒ€ãƒŸãƒ¼ã®è‡¨åºŠãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆï¼ˆå„ç—‡ä¾‹ã® TMB ã‚’ 0 ã«è¨­å®šï¼‰
    clinical.df <- data.frame(Tumor_Sample_Barcode = sample_order,
                              tmb = rep(0, length(sample_order)))
    
    # clinicalData å¼•æ•°ã‚’æŒ‡å®šã—ã¦ MAF ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
    maf_object <- read.maf(maf = as.data.frame(maf_data), 
                           clinicalData = clinical.df, 
                           vc_nonSyn = NULL)
    
    output_path <- file.path(getwd(), "oncoplot.png")
    png(filename = output_path, width = 1200, height = 800)
    
    # sampleOrder ãªã©å¿…è¦ãªå¼•æ•°ã®ã¿æŒ‡å®šï¼ˆTMB ã¯ dummy ã® 0 ãŒä½¿ã‚ã‚Œã‚‹ï¼‰
    oncoplot(maf = maf_object, 
             showTumorSampleBarcodes = TRUE, 
             sampleOrder = sample_order)
    
    dev.off()
    
    print(paste("Oncoplot ã‚’ä¿å­˜ã—ã¾ã—ãŸ:", output_path))
}
q()
library(maftools)
plot_oncoplot <- function(maf_data, clinical_data, sample_order) {
    maf_df <- as.data.frame(maf_data)
    maf_object <- read.maf(maf = maf_df, clinicalData = clinical_data, vc_nonSyn = NULL)
    
    output_path <- file.path(getwd(), "oncoplot.png")
    png(filename = output_path, width = 1200, height = 800)
    
    # clinicalFeatures ã«ã¯ "TMB" ã‚’æŒ‡å®šã—ãªã„ã€draw_titv = FALSE ã‚’è¿½åŠ 
    oncoplot(
        maf = maf_object, 
        showTumorSampleBarcodes = TRUE, 
        sampleOrder = sample_order,
        draw_titv = FALSE  # <--- ã“ã‚Œã§TMBã®æ£’ã‚°ãƒ©ãƒ•ã‚’å‰Šé™¤
    )
    dev.off()
    
    print(paste("Oncoplot ã‚’ä¿å­˜ã—ã¾ã—ãŸ:", output_path))
}
q()
library(maftools)
plot_oncoplot <- function(maf_data, clinical_data, sample_order) {
    maf_df <- as.data.frame(maf_data)
    maf_object <- read.maf(maf = maf_df, clinicalData = clinical_data, vc_nonSyn = NULL)
    output_path <- file.path(getwd(), "oncoplot.png")
    png(filename = output_path, width = 1200, height = 800)
    # clinicalFeatures ã«ã¯ "TMB" ã‚’æŒ‡å®šã—ãªã„ã€draw_titv = FALSE ã‚’è¿½åŠ 
    oncoplot(
        maf = maf_object, 
        showTumorSampleBarcodes = TRUE, 
        sampleOrder = sample_order,
        draw_titv = FALSE  # <--- ã“ã‚Œã§TMBã®æ£’ã‚°ãƒ©ãƒ•ã‚’å‰Šé™¤
    )
    dev.off()
    print(paste("Oncoplot ã‚’ä¿å­˜ã—ã¾ã—ãŸ:", output_path))
}
q()
oncoplot(maf = maf_object, 
         clinicalFeatures = c("TMB", "DFS"), 
         showTumorSampleBarcodes = TRUE, 
         sampleOrder = sample_order)

library(maftools)

maftools::oncoplot(maf = maf_object, clinicalFeatures = c("TMB", "DFS"),
                     showTumorSampleBarcodes = TRUE, sampleOrder = sample_order)

poetry run pathon oncoplot.py
q()
